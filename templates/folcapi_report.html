<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #2d3436; margin: 0; padding: 0; background-color: #f0f2f5; }
        .wrapper { width: 100%; padding: 20px 0; }
        .header { background-color: #ffffff; padding: 35px 20px; text-align: center; border-bottom: 4px solid #004a99; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { max-width: 180px; height: auto; }
        
        .container { max-width: 700px; margin: 30px auto; padding: 0 20px; }
        
        .welcome-card { background: #ffffff; border-radius: 12px; padding: 30px; margin-bottom: 25px; border-left: 6px solid #004a99; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .welcome-text { font-size: 20px; color: #2d3436; margin: 0; }
        .badge-group { margin-top: 15px; }
        .badge { display: inline-block; background: #eef2f7; color: #004a99; padding: 6px 14px; border-radius: 50px; font-size: 13px; font-weight: 700; margin-right: 8px; border: 1px solid #d1d9e6; }
        
        .card { background: #ffffff; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border: 1px solid #e1e8ed; }
        .section-title { font-size: 14px; font-weight: 800; color: #004a99; text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 20px; border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; display: block; }
        
        .metric-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f8f9fa; }
        .metric-item:last-child { border-bottom: none; }
        .metric-label { font-size: 14px; color: #636e72; padding-right: 15px; }
        .metric-value { font-size: 18px; font-weight: 700; color: #004a99; white-space: nowrap; }
        
        .legend-section { background: #dfe6e9; border-radius: 12px; padding: 25px; font-size: 13px; color: #2d3436; margin-top: 35px; border-left: 6px solid #636e72; }
        .legend-title { font-weight: 800; text-transform: uppercase; margin-bottom: 15px; color: #2d3436; display: block; font-size: 12px; }
        .legend-item { margin-bottom: 10px; line-height: 1.5; }
        
        .footer { text-align: center; padding: 40px 20px; font-size: 12px; color: #b2bec3; letter-spacing: 0.5px; }
        .highlight-text { color: #004a99; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header" style="text-align: center;">
        {% if logo_cid %}
            <img src="cid:{{ logo_cid }}" alt="CSA Research" class="logo" width="180" style="display: block; margin: 0 auto;">
        {% endif %}
    </div>

        <div class="container">
            <div class="welcome-card">
                <p class="welcome-text">Gentile <span class="highlight-text">{{ user.name }}</span> (ID: {{ user.id }}),</p>
                <div class="badge-group">
                    <span class="badge">REGIONE: {{ user.regione }}</span>
                    <span class="badge">PERIODO: {{ user.periodo }} {{ user.anno }}</span>
                </div>
                <p style="margin-top: 20px; font-size: 15px; color: #636e72;">
                    di seguito riportiamo gli indicatori di performance da lei fatti registrati.
                </p>
            </div>

            {% set sections = [
                {'title': 'INDICATORI PERSONALI', 'data': user.metrics.personali, 'icon': 'üë§'},
                {'title': 'INDICATORI REGIONE', 'data': user.metrics.regione, 'icon': 'üèôÔ∏è'},
                {'title': 'INDICATORI TOTALE ITALIA', 'data': user.metrics.italia, 'icon': 'üáÆüáπ'}
            ] %}

            {% for section in sections %}
                <div class="card">
                    <span class="section-title">{{ section.icon }} {{ section.title }}</span>
                    
                    <div class="metric-item">
                        <span class="metric-label">Tasso di completezza </span>
                        <span class="metric-value">{{ section.data[0] }}</span>
                    </div>

                    {% if user.is_fol %}
                    <div class="metric-item">
                        <span class="metric-label">Tasso di completezza nelle prime 2 settimana di rilevazione </span>
                        <span class="metric-value">{{ section.data[1] }}</span>
                    </div>
                    {% endif %}

                    <div class="metric-item">
                        <span class="metric-label">Tasso di inserimento del numero di telefono </span>
                        <span class="metric-value">{{ section.data[-1] }}</span>
                    </div>
                </div>
            {% endfor %}

            <div class="legend-section">
                <span class="legend-title">Legenda ‚Äì Descrizione degli indicatori</span>
                <div class="legend-item"><strong>Tasso di completezza:</strong> percentuale di interviste realizzate sul totale delle famiglie assegnate</div>
                <div class="legend-item"><strong>Tasso di completezza nelle prime due settimane di rilevazione:</strong> percentuale di interviste realizzate nelle prime due settimane sul totale delle famiglie intervistate</div>
                <div class="legend-item"><strong>Tasso di inserimento del numero di telefono:</strong> percentuale di recapiti telefonici validi (fissi o mobili) inseriti sul totale delle famiglie intervistate nella prima wave di quartina</div>
            </div>

            <div class="footer">
                <p>Questa √® una comunicazione automatica inviata dal sistema CSA Research.<br>
                &copy; 2026 CSA Research per ISTAT</p>
            </div>
        </div>
    </div>
</body>
</html>